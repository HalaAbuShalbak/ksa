<!DOCTYPE html>
<html lang="ar" dir="rtl" class="overflow-x-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="لوحة تحكم لإدارة الإعلانات - عرض وإدارة جميع إعلاناتك في مكان واحد">
    <meta name="keywords" content="لوحة تحكم, إعلانات, إدارة الإعلانات, لوحة تحكم عربية">
    <meta name="author" content="Your Company Name">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Arabic">
    <meta property="og:title" content="لوحة تحكم الإعلانات">
    <meta property="og:description" content="لوحة تحكم شاملة لإدارة وإظهار جميع إعلاناتك">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="لوحة تحكم الإعلانات">
    <meta name="twitter:description" content="لوحة تحكم شاملة لإدارة وإظهار جميع إعلاناتك">
    
    <title>لوحة التحكم - إعلاناتي</title>
    
    <!-- Arabic Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#FF8059",
                        secondary: "#5FD2BB",
                        accent: "#FFCA3A",
                        background: "#F7F9FA",
                        contrast: "#22242A",
                        card: "#FFFFFF",
                        border: "#E0E3EB",
                        muted: "#B0B2B8",
                    },
                    fontFamily: {
                        cairo: ["Cairo", "sans-serif"],
                        tajawal: ["Tajawal", "sans-serif"],
                    },
                },
            },
        };
    </script>
    
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <style>
        /* Apply Arabic fonts globally */
        body {
            font-family: 'Tajawal', sans-serif;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cairo', sans-serif;
        }
        
        /* Smooth modal animations */
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        
        .modal-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: scale(0.95) translateY(-20px);
            opacity: 0;
        }
        
        .modal-content.show {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        
        /* Loading spinner animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        /* Smooth sidebar transitions - RTL adjusted */
        .sidebar-item {
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        
        .sidebar-item:hover {
            transform: translateX(-4px);
        }
        
        /* Card hover effects */
        .ad-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .ad-card:hover {
            transform: translateY(-4px);
        }
        
        /* Plan card hover effects */
        .plan-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        
        .plan-card:hover {
            transform: translateY(-8px);
        }
        
        /* Prevent horizontal overflow */
        * {
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden !important;
        }
        
        /* Responsive Sidebar */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                right: 0;
                height: 100vh;
                z-index: 40;
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 30;
            }
            
            .sidebar-overlay.active {
                display: block;
            }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .content-area {
                padding: 1rem;
            }
            
            .subscription-section {
                padding: 1rem;
            }
            
            .plan-card {
                padding: 1.25rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 641px) and (max-width: 1024px) {
            .plans-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Pagination button hover effects */
        .pagination-btn:not(:disabled):hover {
            transform: translateY(-2px);
        }
        
        .pagination-page-btn:not(.bg-primary):hover {
            transform: scale(1.1);
        }
        
        /* Mobile pagination adjustments */
        @media (max-width: 640px) {
            #ads-pagination {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .pagination-page-btn {
                width: 2.5rem;
                height: 2.5rem;
                font-size: 0.875rem;
            }
            
            #pagination-prev,
            #pagination-next {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Payment method button selected state */
        .payment-method-btn.selected {
            border-color: #FF8059;
            background-color: rgba(255, 128, 89, 0.1);
        }
        
        .payment-method-btn.selected .font-medium {
            color: #FF8059;
            font-weight: 600;
        }
        
        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-background font-tajawal">
    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar - RTL positioned on right -->
        <aside id="sidebar" class="sidebar w-64 bg-card border-l border-border flex flex-col shadow-sm lg:translate-x-0">
            <div class="p-4 lg:p-6 border-b border-border">
                <div class="flex items-center justify-between mb-2">
                    <h1 class="text-xl lg:text-2xl font-bold text-contrast font-cairo">لوحة التحكم</h1>
                    <!-- Close button for mobile -->
                    <button id="sidebar-close" class="lg:hidden text-contrast hover:text-primary transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <!-- User name for mobile view -->
                <div class="lg:hidden flex items-center gap-2 pt-2 border-t border-border">
                    <span class="text-xs text-muted">مرحباً،</span>
                    <span id="sidebar-user-name" class="text-sm font-semibold text-contrast">محمد أحمد</span>
                </div>
            </div>
            
            <nav class="flex-1 p-4 space-y-2">
                <!-- My Ads Button -->
                <button id="btn-my-ads" class="sidebar-item w-full text-right px-4 py-3 rounded-lg bg-primary text-white font-medium flex items-center gap-3 justify-end">
                    <span>إعلاناتي</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                
                <!-- Plans Button -->
                <button id="btn-plans" class="sidebar-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium flex items-center gap-3 justify-end">
                    <span>الباقات</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
                
                <!-- Add New Ad Button -->
                <button id="btn-add-ad" class="sidebar-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 font-medium flex items-center gap-3 justify-end">
                    <span>إضافة إعلان جديد</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                </button>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Bar -->
            <header class="bg-card border-b border-border px-4 lg:px-6 py-4 shadow-sm">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <!-- Mobile Menu Button -->
                        <button id="sidebar-toggle" class="lg:hidden text-contrast hover:text-primary transition-colors p-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <h2 class="text-lg lg:text-xl font-semibold text-contrast font-cairo">إعلاناتي</h2>
                    </div>
                    <div class="flex items-center gap-2 lg:gap-3">
                        <span id="user-name" class="text-xs lg:text-sm font-semibold text-contrast hidden lg:inline">محمد أحمد</span>
                        <span class="text-xs lg:text-sm text-muted hidden lg:inline">مرحباً،</span>
                    </div>
                </div>
            </header>
            
            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-4 lg:p-6 content-area">
                <!-- Subscription Section -->
                <section class="bg-card rounded-lg shadow-sm p-4 lg:p-6 mb-4 lg:mb-6 border border-border subscription-section">
                    <h3 class="text-base lg:text-lg font-semibold text-contrast mb-3 lg:mb-4 font-cairo">تفاصيل الاشتراك</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">
                        <div>
                            <p class="text-xs lg:text-sm text-muted mb-1">تاريخ البدء</p>
                            <p id="subscription-start" class="text-sm lg:text-base font-medium text-contrast">جاري التحميل...</p>
                        </div>
                        <div>
                            <p class="text-xs lg:text-sm text-muted mb-1">تاريخ الانتهاء</p>
                            <p id="subscription-end" class="text-sm lg:text-base font-medium text-contrast">جاري التحميل...</p>
                        </div>
                        <div>
                            <p class="text-xs lg:text-sm text-muted mb-1">نوع الاشتراك</p>
                            <p id="subscription-type" class="text-sm lg:text-base font-medium text-contrast">جاري التحميل...</p>
                        </div>
                    </div>
                </section>
                
                <!-- Ads Grid Section -->
                <section id="ads-section">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
                        <h3 class="text-base lg:text-lg font-semibold text-contrast font-cairo">إعلاناتك</h3>
                        <div id="ads-count" class="text-xs lg:text-sm text-muted">0 إعلان</div>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="ads-loading" class="hidden flex items-center justify-center py-12">
                        <div class="flex flex-col items-center gap-3">
                            <div class="spinner w-8 h-8 border-4 border-primary border-t-transparent rounded-full"></div>
                            <p class="text-sm text-muted">جاري تحميل الإعلانات...</p>
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="ads-empty" class="hidden text-center py-12 bg-card rounded-lg border border-border">
                        <svg class="w-16 h-16 mx-auto text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                        </svg>
                        <p class="text-muted">لم يتم العثور على إعلانات. أنشئ إعلانك الأول!</p>
                    </div>
                    
                    <!-- Ads Grid -->
                    <div id="ads-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <!-- Ad cards will be dynamically inserted here -->
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div id="ads-pagination" class="hidden mt-6 flex items-center justify-center gap-2">
                        <!-- Previous Button -->
                        <button id="pagination-prev" class="pagination-btn px-4 py-2 rounded-lg border border-border bg-card text-contrast hover:bg-primary hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-card disabled:hover:text-contrast">
                            <span class="flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                </svg>
                                السابق
                            </span>
                        </button>
                        
                        <!-- Page Numbers -->
                        <div id="pagination-numbers" class="flex items-center gap-1">
                            <!-- Page numbers will be dynamically inserted here -->
                        </div>
                        
                        <!-- Next Button -->
                        <button id="pagination-next" class="pagination-btn px-4 py-2 rounded-lg border border-border bg-card text-contrast hover:bg-primary hover:text-white transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-card disabled:hover:text-contrast">
                            <span class="flex items-center gap-2">
                                التالي
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </span>
                        </button>
                    </div>
                </section>
                
                <!-- Plans Section -->
                <section id="plans-section" class="hidden">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4 lg:mb-6">
                        <h3 class="text-xl lg:text-2xl font-semibold text-contrast font-cairo">اختر باقة الاشتراك</h3>
                        <p class="text-xs lg:text-sm text-muted">اختر الباقة التي تناسب احتياجاتك</p>
                    </div>
                    
                    <!-- Plans Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6 plans-grid">
                        <!-- Quarterly Plan Card -->
                        <div class="plan-card bg-card rounded-xl shadow-lg border-2 border-border p-4 sm:p-6 hover:border-primary transition-all duration-300 hover:shadow-xl relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-secondary to-primary"></div>
                            <div class="mb-3 sm:mb-4">
                                <h4 class="text-lg sm:text-xl font-bold text-contrast mb-1 sm:mb-2 font-cairo">ربع سنوي</h4>
                                <p class="text-xs sm:text-sm text-muted">باقة لمدة 3 أشهر</p>
                            </div>
                            <div class="mb-4 sm:mb-6">
                                <div class="flex items-baseline gap-2">
                                    <span class="text-3xl sm:text-4xl font-bold text-contrast font-cairo">299</span>
                                    <span class="text-base sm:text-lg text-muted">ر.س</span>
                                </div>
                                <p class="text-xs text-muted mt-1">99.67 ر.س شهرياً</p>
                            </div>
                            <ul class="space-y-2 sm:space-y-3 mb-4 sm:mb-6">
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>إعلانات غير محدودة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>دعم فني 24/7</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تقارير وتحليلات متقدمة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تحديثات مجانية</span>
                                </li>
                            </ul>
                            <button class="w-full py-2.5 sm:py-3 px-4 bg-gray-100 hover:bg-primary text-gray-700 hover:text-white rounded-lg text-sm sm:text-base font-medium transition-all duration-300 text-center">
                                اختر الباقة
                            </button>
                        </div>
                        
                        <!-- Half Year Plan Card (Featured) -->
                        <div class="plan-card bg-gradient-to-br from-primary/10 to-secondary/10 rounded-xl shadow-xl border-2 border-primary p-4 sm:p-6 hover:shadow-2xl transition-all duration-300 relative overflow-hidden transform hover:scale-105">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-accent"></div>
                            <div class="absolute top-3 left-3 sm:top-4 sm:left-4 bg-primary text-white px-2 sm:px-3 py-1 rounded-full text-xs font-bold font-cairo">
                                الأكثر شعبية
                            </div>
                            <div class="mb-3 sm:mb-4">
                                <h4 class="text-lg sm:text-xl font-bold text-contrast mb-1 sm:mb-2 font-cairo">نصف سنوي</h4>
                                <p class="text-xs sm:text-sm text-muted">باقة لمدة 6 أشهر</p>
                            </div>
                            <div class="mb-4 sm:mb-6">
                                <div class="flex items-baseline gap-2">
                                    <span class="text-3xl sm:text-4xl font-bold text-contrast font-cairo">499</span>
                                    <span class="text-base sm:text-lg text-muted">ر.س</span>
                                </div>
                                <p class="text-xs text-muted mt-1">83.17 ر.س شهرياً</p>
                                <p class="text-xs text-primary font-semibold mt-2">توفير 17%</p>
                            </div>
                            <ul class="space-y-2 sm:space-y-3 mb-4 sm:mb-6">
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>إعلانات غير محدودة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>دعم فني 24/7</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تقارير وتحليلات متقدمة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تحديثات مجانية</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-accent flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>أولوية في الدعم</span>
                                </li>
                            </ul>
                            <button class="w-full py-2.5 sm:py-3 px-4 bg-primary hover:bg-primary/90 text-white rounded-lg text-sm sm:text-base font-medium transition-all duration-300 text-center shadow-lg">
                                اختر الباقة
                            </button>
                        </div>
                        
                        <!-- Yearly Plan Card -->
                        <div class="plan-card bg-card rounded-xl shadow-lg border-2 border-border p-4 sm:p-6 hover:border-secondary transition-all duration-300 hover:shadow-xl relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-secondary to-accent"></div>
                            <div class="mb-3 sm:mb-4">
                                <h4 class="text-lg sm:text-xl font-bold text-contrast mb-1 sm:mb-2 font-cairo">سنوي</h4>
                                <p class="text-xs sm:text-sm text-muted">باقة لمدة 12 شهراً</p>
                            </div>
                            <div class="mb-4 sm:mb-6">
                                <div class="flex items-baseline gap-2">
                                    <span class="text-3xl sm:text-4xl font-bold text-contrast font-cairo">899</span>
                                    <span class="text-base sm:text-lg text-muted">ر.س</span>
                                </div>
                                <p class="text-xs text-muted mt-1">74.92 ر.س شهرياً</p>
                                <p class="text-xs text-secondary font-semibold mt-2">توفير 25%</p>
                            </div>
                            <ul class="space-y-2 sm:space-y-3 mb-4 sm:mb-6">
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>إعلانات غير محدودة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>دعم فني 24/7</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تقارير وتحليلات متقدمة</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-secondary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>تحديثات مجانية</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-accent flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>أولوية في الدعم</span>
                                </li>
                                <li class="flex items-center gap-2 text-xs sm:text-sm text-contrast">
                                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-accent flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>ميزات حصرية</span>
                                </li>
                            </ul>
                            <button class="w-full py-2.5 sm:py-3 px-4 bg-secondary hover:bg-secondary/90 text-white rounded-lg text-sm sm:text-base font-medium transition-all duration-300 text-center">
                                اختر الباقة
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4">
        <div class="modal-content bg-card rounded-lg shadow-xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-card border-b border-border px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
                <h3 id="modal-title" class="text-lg sm:text-xl font-semibold text-contrast font-cairo">تفاصيل الإعلان</h3>
                <button id="modal-close" class="text-muted hover:text-contrast transition-colors p-1">
                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Loading State -->
            <div id="modal-loading" class="flex items-center justify-center py-8 sm:py-12">
                <div class="flex flex-col items-center gap-3">
                    <div class="spinner w-8 h-8 border-4 border-primary border-t-transparent rounded-full"></div>
                    <p class="text-xs sm:text-sm text-muted">جاري تحميل تفاصيل الإعلان...</p>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div id="modal-content" class="hidden p-4 sm:p-6">
                <div class="mb-4 sm:mb-6">
                    <img id="modal-image" src="" alt="صورة الإعلان" class="w-full h-48 sm:h-64 object-cover rounded-lg mb-3 sm:mb-4">
                    <h4 id="modal-name" class="text-xl sm:text-2xl font-bold text-contrast mb-2 font-cairo"></h4>
                    <p id="modal-description" class="text-sm sm:text-base text-muted mb-3 sm:mb-4"></p>
                </div>
                
                <!-- Pricing Information -->
                <div class="mb-4 sm:mb-6 p-4 bg-gray-50 rounded-lg border border-border">
                    <h5 class="text-base font-semibold text-contrast mb-3 font-cairo">معلومات التسعير</h5>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div>
                            <p class="text-sm text-muted mb-1">السعر الأصلي</p>
                            <p id="modal-price" class="text-base font-medium text-contrast"></p>
                        </div>
                        <div>
                            <p class="text-sm text-muted mb-1">الخصم</p>
                            <p id="modal-discount" class="text-base font-medium text-contrast"></p>
                        </div>
                        <div>
                            <p class="text-sm text-muted mb-1">السعر النهائي</p>
                            <p id="modal-final-price" class="text-lg font-bold text-primary"></p>
                        </div>
                    </div>
                </div>
                
                <!-- Coupons Section -->
                <div id="modal-coupons-section" class="mb-4 sm:mb-6 hidden">
                    <h5 class="text-base font-semibold text-contrast mb-3 font-cairo">كوبونات الخصم</h5>
                    <div id="modal-coupons-list" class="space-y-2">
                        <!-- Coupons will be dynamically inserted here -->
                    </div>
                </div>
                
                <!-- Dates Information -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 border-t border-border pt-3 sm:pt-4">
                    <div>
                        <p class="text-sm text-muted mb-1">الحالة</p>
                        <p id="modal-status" class="text-base font-medium text-contrast"></p>
                    </div>
                    <div>
                        <p class="text-sm text-muted mb-1">تاريخ انتهاء الإعلان</p>
                        <p id="modal-expiration" class="text-base font-medium text-contrast"></p>
                    </div>
                    <div id="modal-discount-start-container" class="hidden">
                        <p class="text-sm text-muted mb-1">تاريخ بدء الخصم</p>
                        <p id="modal-discount-start" class="text-base font-medium text-contrast"></p>
                    </div>
                    <div id="modal-discount-end-container" class="hidden">
                        <p class="text-sm text-muted mb-1">تاريخ انتهاء الخصم</p>
                        <p id="modal-discount-end" class="text-base font-medium text-contrast"></p>
                    </div>
                    <div>
                        <p class="text-sm text-muted mb-1">تاريخ الإنشاء</p>
                        <p id="modal-created" class="text-base font-medium text-contrast"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Methods Modal -->
    <div id="payment-modal-overlay" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4">
        <div class="modal-content bg-card rounded-lg shadow-xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-card border-b border-border px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
                <h3 class="text-lg sm:text-xl font-semibold text-contrast font-cairo">اختر طريقة الدفع</h3>
                <button id="payment-modal-close" class="text-muted hover:text-contrast transition-colors p-1">
                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Payment Modal Content -->
            <div class="p-4 sm:p-6">
                <!-- Plan Summary -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6 border border-border">
                    <h4 id="payment-plan-name" class="text-lg font-bold text-contrast mb-2 font-cairo"></h4>
                    <div class="flex items-baseline gap-2">
                        <span id="payment-plan-price" class="text-2xl font-bold text-primary font-cairo"></span>
                        <span class="text-muted">ر.س</span>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div class="mb-6">
                    <h4 class="text-base font-semibold text-contrast mb-4 font-cairo">طرق الدفع المتاحة</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <!-- Mada -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="mada">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                    <span class="text-blue-600 font-bold text-lg">مدى</span>
                                </div>
                                <span class="font-medium text-contrast">مدى</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        
                        <!-- Visa -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="visa">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold text-xs">VISA</span>
                                </div>
                                <span class="font-medium text-contrast">فيزا</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        
                        <!-- Mastercard -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="mastercard">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold text-xs">MC</span>
                                </div>
                                <span class="font-medium text-contrast">ماستركارد</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        
                        <!-- STC Pay -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="stc-pay">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold text-xs">STC</span>
                                </div>
                                <span class="font-medium text-contrast">STC Pay</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        
                        <!-- Apple Pay -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="apple-pay">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-black rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                    </svg>
                                </div>
                                <span class="font-medium text-contrast">Apple Pay</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        
                        <!-- Tamara -->
                        <button class="payment-method-btn p-4 border-2 border-border rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-300 text-right flex items-center justify-between group" data-method="tamara">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold text-xs">تمارا</span>
                                </div>
                                <span class="font-medium text-contrast">تمارا</span>
                            </div>
                            <svg class="w-5 h-5 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Payment Info Note -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-800 text-right">
                        <strong>ملاحظة:</strong> سيتم توجيهك إلى صفحة الدفع الآمنة لإتمام عملية الدفع
                    </p>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-3">
                    <button id="payment-cancel-btn" class="flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300 text-center">
                        إلغاء
                    </button>
                    <button id="payment-confirm-btn" class="flex-1 py-3 px-4 bg-primary hover:bg-primary/90 text-white rounded-lg font-medium transition-all duration-300 text-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        تأكيد الدفع
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add New Ad Modal -->
    <div id="add-ad-modal-overlay" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4">
        <div class="modal-content bg-card rounded-lg shadow-xl max-w-4xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-card border-b border-border px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
                <h3 class="text-lg sm:text-xl font-semibold text-contrast font-cairo">إضافة إعلان جديد</h3>
                <button id="add-ad-modal-close" class="text-muted hover:text-contrast transition-colors p-1">
                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Add Ad Form -->
            <form id="add-ad-form" class="p-4 sm:p-6">
                <!-- Basic Information Section -->
                <div class="mb-6">
                    <h4 class="text-base font-semibold text-contrast mb-4 font-cairo">المعلومات الأساسية</h4>
                    <div class="space-y-4">
                        <!-- Ad Title -->
                        <div>
                            <label for="ad-title" class="block text-sm font-medium text-contrast mb-2">عنوان الإعلان *</label>
                            <input type="text" id="ad-title" name="title" required class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="أدخل عنوان الإعلان">
                        </div>
                        
                        <!-- Ad Description -->
                        <div>
                            <label for="ad-description" class="block text-sm font-medium text-contrast mb-2">وصف الإعلان *</label>
                            <textarea id="ad-description" name="description" required rows="4" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none" placeholder="أدخل وصف الإعلان"></textarea>
                        </div>
                        
                        <!-- Ad Asset (Image) -->
                        <div>
                            <label for="ad-asset" class="block text-sm font-medium text-contrast mb-2">صورة الإعلان *</label>
                            <input type="file" id="ad-asset" name="asset" accept="image/*" required class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
                            <p class="text-xs text-muted mt-1">الصيغ المدعومة: JPG, PNG, GIF (حد أقصى 5MB)</p>
                            <div id="image-preview" class="mt-3 hidden">
                                <img id="preview-img" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg border border-border">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pricing Section -->
                <div class="mb-6">
                    <h4 class="text-base font-semibold text-contrast mb-4 font-cairo">معلومات التسعير</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Price -->
                        <div>
                            <label for="ad-price" class="block text-sm font-medium text-contrast mb-2">السعر (ر.س) *</label>
                            <input type="number" id="ad-price" name="price" required min="0" step="0.01" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="0.00">
                        </div>
                        
                        <!-- Discount -->
                        <div>
                            <label for="ad-discount" class="block text-sm font-medium text-contrast mb-2">الخصم (%)</label>
                            <input type="number" id="ad-discount" name="discount" min="0" max="100" step="0.01" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="0.00">
                        </div>
                        
                        <!-- Discount Start Date -->
                        <div>
                            <label for="discount-start-date" class="block text-sm font-medium text-contrast mb-2">تاريخ بدء الخصم</label>
                            <input type="date" id="discount-start-date" name="discountStartDate" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
                        </div>
                        
                        <!-- Discount End Date -->
                        <div>
                            <label for="discount-end-date" class="block text-sm font-medium text-contrast mb-2">تاريخ انتهاء الخصم</label>
                            <input type="date" id="discount-end-date" name="discountEndDate" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
                        </div>
                    </div>
                </div>
                
                <!-- Coupons Section -->
                <div class="mb-6">
                    <h4 class="text-base font-semibold text-contrast mb-4 font-cairo">كوبونات الخصم</h4>
                    <div id="coupons-container" class="space-y-4">
                        <!-- Coupon fields will be dynamically added here -->
                    </div>
                    <button type="button" id="add-coupon-btn" class="mt-4 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300 text-sm">
                        + إضافة كوبون
                    </button>
                </div>
                
                <!-- Dates Section -->
                <div class="mb-6">
                    <h4 class="text-base font-semibold text-contrast mb-4 font-cairo">تواريخ الإعلان</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Ad Expiration Date -->
                        <div>
                            <label for="ad-expiration-date" class="block text-sm font-medium text-contrast mb-2">تاريخ انتهاء الإعلان *</label>
                            <input type="date" id="ad-expiration-date" name="expirationDate" required class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="flex gap-3 pt-4 border-t border-border">
                    <button type="button" id="add-ad-cancel-btn" class="flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-300 text-center">
                        إلغاء
                    </button>
                    <button type="submit" id="add-ad-submit-btn" class="flex-1 py-3 px-4 bg-primary hover:bg-primary/90 text-white rounded-lg font-medium transition-all duration-300 text-center">
                        إضافة الإعلان
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        /**
         * ============================================
         * DASHBOARD API INTEGRATION GUIDE
         * دليل تكامل API للوحة التحكم
         * ============================================
         * 
         * Expected API Endpoints:
         * نقاط نهاية API المتوقعة:
         * 
         * 1. GET /api/ads
         *    Response: { data: [{ id, name, image, ... }] } or [{ id, name, image, ... }]
         *    Returns: Array of ad objects
         * 
         * 2. GET /api/ads/{id}
         *    Response: { data: { id, name, image, description, status, created, ... } } or { id, name, ... }
         *    Returns: Single ad object with full details
         * 
         * Error Handling:
         * معالجة الأخطاء:
         * - On API failure, the dashboard falls back to placeholder data
         * - عند فشل API، تعود لوحة التحكم إلى البيانات التجريبية
         * - Check browser console for API errors
         * - تحقق من وحدة التحكم في المتصفح لأخطاء API
         */
        
        // Configuration - API endpoints
        // التكوين - نقاط نهاية API
        const API_BASE = '/api';
        const API_ADS = `${API_BASE}/ads`;
        
        // State management
        // إدارة الحالة
        let currentAds = [];
        let currentPage = 1;
        const itemsPerPage = 6;
        let selectedPaymentMethod = null;
        let couponCounter = 0;
        
        // Initialize dashboard on page load
        $(document).ready(function() {
            initializeDashboard();
            setupEventListeners();
            setupMobileMenu();
        });
        
        /**
         * Setup mobile menu toggle functionality
         * إعداد وظيفة تبديل القائمة المحمولة
         */
        function setupMobileMenu() {
            const $sidebar = $('#sidebar');
            const $overlay = $('#sidebar-overlay');
            const $toggle = $('#sidebar-toggle');
            const $close = $('#sidebar-close');
            
            // Toggle sidebar on hamburger click
            $toggle.on('click', function() {
                $sidebar.addClass('open');
                $overlay.addClass('active');
                $('body').css('overflow', 'hidden'); // Prevent body scroll when sidebar is open
            });
            
            // Close sidebar on close button click
            $close.on('click', function() {
                $sidebar.removeClass('open');
                $overlay.removeClass('active');
                $('body').css('overflow', '');
            });
            
            // Close sidebar on overlay click
            $overlay.on('click', function() {
                $sidebar.removeClass('open');
                $overlay.removeClass('active');
                $('body').css('overflow', '');
            });
            
            // Close sidebar when clicking a navigation item on mobile
            $('.sidebar-item').on('click', function() {
                if (window.innerWidth < 768) {
                    setTimeout(function() {
                        $sidebar.removeClass('open');
                        $overlay.removeClass('active');
                        $('body').css('overflow', '');
                    }, 300);
                }
            });
            
            // Close sidebar on window resize if it becomes desktop size
            $(window).on('resize', function() {
                if (window.innerWidth >= 768) {
                    $sidebar.removeClass('open');
                    $overlay.removeClass('active');
                    $('body').css('overflow', '');
                }
            });
        }
        
        /**
         * Update username in both header and sidebar
         * تحديث اسم المستخدم في كل من الرأس والشريط الجانبي
         */
        function updateUserName(name) {
            $('#user-name').text(name);
            $('#sidebar-user-name').text(name);
        }
        
        /**
         * Initialize dashboard by loading subscription data and ads
         */
        function initializeDashboard() {
            loadSubscriptionData();
            loadAds();
            // Sync usernames on initialization
            const currentUserName = $('#user-name').text();
            if (currentUserName) {
                $('#sidebar-user-name').text(currentUserName);
            }
        }
        
        /**
         * Setup event listeners for buttons and modal
         * إعداد مستمعي الأحداث للأزرار والنافذة المنبثقة
         */
        function setupEventListeners() {
            // Sidebar navigation
            // التنقل في الشريط الجانبي
            $('#btn-my-ads').on('click', function() {
                updateActiveButton($(this));
                showAdsView();
            });
            
            $('#btn-plans').on('click', function() {
                updateActiveButton($(this));
                showPlansView();
            });
            
            $('#btn-add-ad').on('click', function() {
                updateActiveButton($(this));
                openAddAdModal();
            });
            
            // Add Ad Modal controls
            $('#add-ad-modal-close').on('click', closeAddAdModal);
            $('#add-ad-cancel-btn').on('click', closeAddAdModal);
            $('#add-ad-modal-overlay').on('click', function(e) {
                if ($(e.target).is('#add-ad-modal-overlay')) {
                    closeAddAdModal();
                }
            });
            
            // Image preview
            $('#ad-asset').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#preview-img').attr('src', e.target.result);
                        $('#image-preview').removeClass('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Add coupon button
            $('#add-coupon-btn').on('click', function() {
                couponCounter++;
                addCouponField(couponCounter);
            });
            
            // Remove coupon button (using event delegation)
            $(document).on('click', '.remove-coupon-btn', function() {
                $(this).closest('.coupon-field').remove();
            });
            
            // Form submission
            $('#add-ad-form').on('submit', function(e) {
                e.preventDefault();
                submitAdForm();
            });
            
            // Modal controls
            $('#modal-close').on('click', closeModal);
            $('#modal-overlay').on('click', function(e) {
                // Close modal when clicking overlay (but not modal content)
                if ($(e.target).is('#modal-overlay')) {
                    closeModal();
                }
            });
            
            // Close modal on Escape key
            $(document).on('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (!$('#modal-overlay').hasClass('hidden')) {
                        closeModal();
                    }
                    if (!$('#payment-modal-overlay').hasClass('hidden')) {
                        closePaymentModal();
                    }
                    if (!$('#add-ad-modal-overlay').hasClass('hidden')) {
                        closeAddAdModal();
                    }
                }
            });
            
            // Plan selection buttons (using event delegation)
            // أزرار اختيار الباقات (باستخدام تفويض الأحداث)
            $(document).on('click', '.plan-card button', function() {
                const planCard = $(this).closest('.plan-card');
                const planName = planCard.find('h4').text();
                const planPrice = planCard.find('.text-3xl, .text-4xl').first().text();
                
                // Open payment methods modal
                openPaymentModal(planName, planPrice);
            });
            
            // Payment modal controls
            // عناصر التحكم في نافذة الدفع
            $('#payment-modal-close').on('click', closePaymentModal);
            $('#payment-cancel-btn').on('click', closePaymentModal);
            $('#payment-modal-overlay').on('click', function(e) {
                // Close modal when clicking overlay (but not modal content)
                if ($(e.target).is('#payment-modal-overlay')) {
                    closePaymentModal();
                }
            });
            
            // Payment method selection
            // اختيار طريقة الدفع
            $(document).on('click', '.payment-method-btn', function() {
                // Remove selected state from all buttons
                $('.payment-method-btn').removeClass('selected');
                
                // Add selected state to clicked button
                $(this).addClass('selected');
                
                // Store selected method and enable confirm button
                selectedPaymentMethod = $(this).data('method');
                $('#payment-confirm-btn').prop('disabled', false);
            });
            
            // Confirm payment button
            $('#payment-confirm-btn').on('click', function() {
                if (selectedPaymentMethod) {
                    const planName = $('#payment-plan-name').text();
                    const planPrice = $('#payment-plan-price').text();
                    processPayment(planName, planPrice, selectedPaymentMethod);
                }
            });
            
            // Pagination controls
            // عناصر التحكم في التصفح
            $('#pagination-prev').on('click', function() {
                if (currentPage > 1) {
                    goToPage(currentPage - 1);
                }
            });
            
            $('#pagination-next').on('click', function() {
                const totalPages = Math.ceil(currentAds.length / itemsPerPage);
                if (currentPage < totalPages) {
                    goToPage(currentPage + 1);
                }
            });
            
            // Page number buttons (using event delegation)
            $(document).on('click', '.pagination-page-btn', function() {
                const page = parseInt($(this).data('page'));
                goToPage(page);
            });
        }
        
        /**
         * Update active button styling in sidebar
         * تحديث تنسيق الزر النشط في الشريط الجانبي
         */
        function updateActiveButton($button) {
            $('.sidebar-item').removeClass('bg-primary text-white').addClass('text-gray-700 hover:bg-gray-100');
            $button.removeClass('text-gray-700 hover:bg-gray-100').addClass('bg-primary text-white');
        }
        
        /**
         * Show ads view and hide plans view
         * عرض صفحة الإعلانات وإخفاء صفحة الباقات
         */
        function showAdsView() {
            // Update header title
            $('header h2').text('إعلاناتي');
            
            // Hide plans section
            $('#plans-section').addClass('hidden');
            
            // Show ads section
            $('#ads-section').removeClass('hidden');
            
            // Load ads if not already loaded
            // Only show loading state when actually making API call
            if (currentAds.length === 0) {
                loadAds();
            } else {
                // Ads already loaded, just render them (no loading state)
                renderAds(currentAds);
            }
        }
        
        /**
         * Show plans view and hide ads view
         * عرض صفحة الباقات وإخفاء صفحة الإعلانات
         */
        function showPlansView() {
            // Update header title
            $('header h2').text('الباقات');
            
            // Hide ads section
            $('#ads-section').addClass('hidden');
            
            // Show plans section
            $('#plans-section').removeClass('hidden');
        }
        
        /**
         * Load subscription data from API
         * تحميل بيانات الاشتراك من API
         */
        function loadSubscriptionData() {
            // Show loading state
            $('#subscription-start').text('جاري التحميل...');
            $('#subscription-end').text('جاري التحميل...');
            $('#subscription-type').text('جاري التحميل...');
            
            // Make API call
            $.ajax({
                url: `${API_BASE}/subscription`,
                method: 'GET',
                timeout: 10000,
                success: function(response) {
                    // Handle successful response
                    const subscriptionData = response.data || response || {
                        startDate: '2024-01-15',
                        endDate: '2024-12-31',
                        type: 'بريميوم'
                    };
                    
                    $('#subscription-start').text(formatDate(subscriptionData.startDate));
                    $('#subscription-end').text(formatDate(subscriptionData.endDate));
                    $('#subscription-type').text(subscriptionData.type || 'غير محدد');
                },
                error: function(xhr, status, error) {
                    // Handle error - use placeholder data
                    console.warn('Subscription API call failed, using placeholder data:', error);
                    const subscriptionData = {
                        startDate: '2024-01-15',
                        endDate: '2024-12-31',
                        type: 'بريميوم'
                    };
                    
                    $('#subscription-start').text(formatDate(subscriptionData.startDate));
                    $('#subscription-end').text(formatDate(subscriptionData.endDate));
                    $('#subscription-type').text(subscriptionData.type);
                }
            });
        }
        
        /**
         * Load ads from API
         */
        function loadAds() {
            // Reset pagination to first page
            currentPage = 1;
            
            // Show loading state
            $('#ads-loading').removeClass('hidden');
            $('#ads-grid').addClass('hidden');
            $('#ads-empty').addClass('hidden');
            $('#ads-pagination').addClass('hidden');
            
            // Simulate API call
            $.ajax({
                url: API_ADS,
                method: 'GET',
                timeout: 10000,
                success: function(response) {
                    // Handle successful response
                    currentAds = response.data || response || [];
                    renderAds(currentAds);
                },
                error: function(xhr, status, error) {
                    // Handle error - use placeholder data
                    console.warn('API call failed, using placeholder data:', error);
                    usePlaceholderAds();
                }
            });
        }
        
        /**
         * Use placeholder ads when API is unavailable
         * استخدام إعلانات تجريبية عندما يكون API غير متاح
         */
        function usePlaceholderAds() {
            // Reset pagination to first page
            currentPage = 1;
            
            const placeholderAds = [
                { id: 1, name: 'حملة التخفيضات الصيفية', image: '' },
                { id: 2, name: 'إطلاق منتج جديد', image: '' },
                { id: 3, name: 'عرض العيد الخاص', image: '' },
                { id: 4, name: 'حملة التوعية بالعلامة التجارية', image: '' },
                { id: 5, name: 'عرض لفترة محدودة', image: '' },
                { id: 6, name: 'شهادة عميل', image: '' }
            ];
            
            currentAds = placeholderAds;
            renderAds(currentAds);
        }
        
        /**
         * Render ads grid with pagination
         * عرض شبكة الإعلانات مع التصفح
         */
        function renderAds(ads) {
            // Hide loading state
            $('#ads-loading').addClass('hidden');
            
            if (ads.length === 0) {
                $('#ads-empty').removeClass('hidden');
                $('#ads-grid').addClass('hidden');
                $('#ads-pagination').addClass('hidden');
                $('#ads-count').text('0 إعلان');
                return;
            }
            
            // Reset to first page if current page is out of bounds
            const totalPages = Math.ceil(ads.length / itemsPerPage);
            if (currentPage > totalPages) {
                currentPage = 1;
            }
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedAds = ads.slice(startIndex, endIndex);
            
            // Show grid and update count
            $('#ads-grid').removeClass('hidden').empty();
            $('#ads-empty').addClass('hidden');
            
            // Arabic pluralization: 1 إعلان, 2-10 إعلانات, 11+ إعلان
            const countText = ads.length === 1 ? 'إعلان' : ads.length === 2 ? 'إعلانان' : ads.length <= 10 ? 'إعلانات' : 'إعلان';
            $('#ads-count').text(`${ads.length} ${countText}`);
            
            // Render paginated ad cards
            paginatedAds.forEach(function(ad) {
                // Only show image if it exists
                const imageHtml = ad.image || ad.asset ? 
                    `<img src="${ad.image || ad.asset}" alt="${ad.name || ad.title}" class="w-full h-full object-cover">` : 
                    `<div class="w-full h-full flex items-center justify-center text-muted text-sm">لا توجد صورة</div>`;
                
                // Price display
                const price = ad.price ? parseFloat(ad.price).toFixed(2) : '0.00';
                const discount = ad.discount ? parseFloat(ad.discount) : 0;
                const finalPrice = discount > 0 ? (price * (1 - discount / 100)).toFixed(2) : price;
                
                // Discount badge
                const discountBadge = discount > 0 ? 
                    `<span class="inline-block bg-primary text-white text-xs font-bold px-2 py-1 rounded">خصم ${discount}%</span>` : '';
                
                // Coupons info
                const couponsCount = ad.coupons && Array.isArray(ad.coupons) ? ad.coupons.length : 0;
                const couponsInfo = couponsCount > 0 ? 
                    `<div class="flex items-center gap-1 text-xs text-muted mt-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        <span>${couponsCount} كوبون</span>
                    </div>` : '';
                
                // Expiration date
                const expirationDate = ad.expirationDate ? formatDate(ad.expirationDate) : 'غير محدد';
                
                // Discount dates
                const discountDates = (ad.discountStartDate && ad.discountEndDate) ? 
                    `<div class="text-xs text-muted mt-1">الخصم: ${formatDate(ad.discountStartDate)} - ${formatDate(ad.discountEndDate)}</div>` : '';
                
                const cardHtml = `
                    <div class="ad-card bg-card rounded-lg shadow-sm border border-border overflow-hidden cursor-pointer" data-ad-id="${ad.id}">
                        <div class="aspect-video bg-gray-100 overflow-hidden relative">
                            ${imageHtml}
                            ${discountBadge ? `<div class="absolute top-2 left-2">${discountBadge}</div>` : ''}
                        </div>
                        <div class="p-4">
                            <h4 class="font-semibold text-contrast truncate mb-2">${ad.name || ad.title || 'إعلان بدون اسم'}</h4>
                            ${ad.description ? `<p class="text-xs text-muted mb-2 line-clamp-2">${ad.description}</p>` : ''}
                            <div class="flex items-center justify-between mb-2">
                                <div>
                                    ${discount > 0 ? `<span class="text-xs text-muted line-through">${price} ر.س</span>` : ''}
                                    <span class="text-lg font-bold text-primary ml-2">${finalPrice} ر.س</span>
                                </div>
                            </div>
                            ${couponsInfo}
                            ${discountDates}
                            <div class="text-xs text-muted mt-2">ينتهي: ${expirationDate}</div>
                        </div>
                    </div>
                `;
                
                $('#ads-grid').append(cardHtml);
            });
            
            // Attach click handlers to ad cards
            $('.ad-card').on('click', function() {
                const adId = $(this).data('ad-id');
                openAdModal(adId);
            });
            
            // Render pagination controls
            renderPagination(ads.length, totalPages);
        }
        
        /**
         * Render pagination controls
         * عرض عناصر التحكم في التصفح
         */
        function renderPagination(totalItems, totalPages) {
            if (totalPages <= 1) {
                $('#ads-pagination').addClass('hidden');
                return;
            }
            
            $('#ads-pagination').removeClass('hidden');
            
            // Update previous/next buttons
            $('#pagination-prev').prop('disabled', currentPage === 1);
            $('#pagination-next').prop('disabled', currentPage === totalPages);
            
            // Render page numbers
            const $paginationNumbers = $('#pagination-numbers');
            $paginationNumbers.empty();
            
            // Calculate which page numbers to show
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            // Adjust if we're near the start or end
            if (endPage - startPage < 4) {
                if (startPage === 1) {
                    endPage = Math.min(5, totalPages);
                } else if (endPage === totalPages) {
                    startPage = Math.max(1, totalPages - 4);
                }
            }
            
            // Add first page if not in range
            if (startPage > 1) {
                $paginationNumbers.append(createPageButton(1));
                if (startPage > 2) {
                    $paginationNumbers.append('<span class="px-2 text-muted">...</span>');
                }
            }
            
            // Add page numbers in range
            for (let i = startPage; i <= endPage; i++) {
                $paginationNumbers.append(createPageButton(i));
            }
            
            // Add last page if not in range
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    $paginationNumbers.append('<span class="px-2 text-muted">...</span>');
                }
                $paginationNumbers.append(createPageButton(totalPages));
            }
        }
        
        /**
         * Create a page number button
         * إنشاء زر رقم الصفحة
         */
        function createPageButton(pageNum) {
            const isActive = pageNum === currentPage;
            const activeClass = isActive ? 'bg-primary text-white border-primary' : 'bg-card text-contrast border-border hover:bg-primary hover:text-white';
            return $(`
                <button class="pagination-page-btn w-10 h-10 rounded-lg border ${activeClass} transition-all duration-300 font-medium" data-page="${pageNum}">
                    ${pageNum}
                </button>
            `);
        }
        
        /**
         * Go to specific page
         * الانتقال إلى صفحة محددة
         */
        function goToPage(page) {
            if (page < 1 || page > Math.ceil(currentAds.length / itemsPerPage)) {
                return;
            }
            currentPage = page;
            renderAds(currentAds);
            // Scroll to top of ads section
            $('#ads-section').get(0).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        /**
         * Open modal and load ad details
         */
        function openAdModal(adId) {
            // Show modal overlay
            $('#modal-overlay').removeClass('hidden');
            
            // Reset modal content
            $('#modal-loading').removeClass('hidden');
            $('#modal-content').addClass('hidden');
            
            // Reset image container - remove any placeholder and show image element
            const $imageContainer = $('#modal-image').parent();
            $imageContainer.find('.no-image-placeholder').remove();
            $('#modal-image').removeClass('hidden');
            
            // Trigger animation after a brief delay
            setTimeout(function() {
                $('.modal-content').addClass('show');
            }, 10);
            
            // Fetch ad details
            $.ajax({
                url: `${API_ADS}/${adId}`,
                method: 'GET',
                timeout: 10000,
                success: function(response) {
                    const ad = response.data || response;
                    populateModal(ad);
                },
                error: function(xhr, status, error) {
                    // Use placeholder data
                    console.warn('API call failed, using placeholder data:', error);
                    const placeholderAd = currentAds.find(a => a.id === adId) || {
                        id: adId,
                        name: 'تفاصيل الإعلان',
                        image: '',
                        description: 'هذا وصف تجريبي للإعلان. سيتم تحميل البيانات الفعلية من API.',
                        status: 'نشط',
                        created: new Date().toISOString().split('T')[0]
                    };
                    populateModal(placeholderAd);
                }
            });
        }
        
        /**
         * Populate modal with ad data
         * ملء النافذة المنبثقة ببيانات الإعلان
         */
        function populateModal(ad) {
            // Hide loading, show content
            $('#modal-loading').addClass('hidden');
            $('#modal-content').removeClass('hidden');
            
            // Populate basic fields
            const adName = ad.name || ad.title || 'إعلان بدون اسم';
            $('#modal-title').text(adName);
            $('#modal-name').text(adName);
            $('#modal-description').text(ad.description || 'لا يوجد وصف متاح.');
            $('#modal-status').text(ad.status || 'غير معروف');
            $('#modal-created').text(ad.created ? formatDate(ad.created) : 'غير متاح');
            
            // Handle image - show only if exists, otherwise show placeholder text
            const $imageContainer = $('#modal-image').parent();
            const imageUrl = ad.image || ad.asset;
            if (imageUrl) {
                $('#modal-image').attr('src', imageUrl).removeClass('hidden').on('error', function() {
                    $(this).addClass('hidden');
                    if ($imageContainer.find('.no-image-placeholder').length === 0) {
                        $imageContainer.append('<div class="no-image-placeholder w-full h-48 sm:h-64 flex items-center justify-center bg-gray-100 rounded-lg text-muted text-sm">لا توجد صورة</div>');
                    }
                });
                $imageContainer.find('.no-image-placeholder').remove();
            } else {
                $('#modal-image').addClass('hidden');
                if ($imageContainer.find('.no-image-placeholder').length === 0) {
                    $imageContainer.append('<div class="no-image-placeholder w-full h-48 sm:h-64 flex items-center justify-center bg-gray-100 rounded-lg text-muted text-sm">لا توجد صورة</div>');
                }
            }
            
            // Populate pricing information
            const price = ad.price ? parseFloat(ad.price).toFixed(2) : '0.00';
            const discount = ad.discount ? parseFloat(ad.discount) : 0;
            const finalPrice = discount > 0 ? (price * (1 - discount / 100)).toFixed(2) : price;
            
            $('#modal-price').text(`${price} ر.س`);
            $('#modal-discount').text(discount > 0 ? `${discount}%` : 'لا يوجد');
            $('#modal-final-price').text(`${finalPrice} ر.س`);
            
            // Populate expiration date
            $('#modal-expiration').text(ad.expirationDate ? formatDate(ad.expirationDate) : 'غير محدد');
            
            // Populate discount dates
            if (ad.discountStartDate && ad.discountEndDate) {
                $('#modal-discount-start-container').removeClass('hidden');
                $('#modal-discount-end-container').removeClass('hidden');
                $('#modal-discount-start').text(formatDate(ad.discountStartDate));
                $('#modal-discount-end').text(formatDate(ad.discountEndDate));
            } else {
                $('#modal-discount-start-container').addClass('hidden');
                $('#modal-discount-end-container').addClass('hidden');
            }
            
            // Populate coupons
            if (ad.coupons && Array.isArray(ad.coupons) && ad.coupons.length > 0) {
                $('#modal-coupons-section').removeClass('hidden');
                const $couponsList = $('#modal-coupons-list');
                $couponsList.empty();
                
                ad.coupons.forEach(function(coupon) {
                    const couponHtml = `
                        <div class="p-3 bg-white border border-border rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-contrast">${coupon.code || 'بدون كود'}</span>
                                <span class="text-primary font-bold">${coupon.discount || 0}%</span>
                            </div>
                            ${coupon.expirationDate ? `<p class="text-xs text-muted">ينتهي: ${formatDate(coupon.expirationDate)}</p>` : ''}
                        </div>
                    `;
                    $couponsList.append(couponHtml);
                });
            } else {
                $('#modal-coupons-section').addClass('hidden');
            }
        }
        
        /**
         * Close modal with animation
         */
        function closeModal() {
            $('.modal-content').removeClass('show');
            
            setTimeout(function() {
                $('#modal-overlay').addClass('hidden');
                $('#modal-loading').removeClass('hidden');
                $('#modal-content').addClass('hidden');
            }, 300);
        }
        
        /**
         * Open payment methods modal
         * فتح نافذة طرق الدفع
         */
        function openPaymentModal(planName, planPrice) {
            // Reset selection
            selectedPaymentMethod = null;
            $('.payment-method-btn').removeClass('selected');
            $('#payment-confirm-btn').prop('disabled', true);
            
            // Set plan details
            $('#payment-plan-name').text(planName);
            $('#payment-plan-price').text(planPrice);
            
            // Show modal overlay
            $('#payment-modal-overlay').removeClass('hidden');
            
            // Trigger animation after a brief delay
            setTimeout(function() {
                $('#payment-modal-overlay .modal-content').addClass('show');
            }, 10);
        }
        
        /**
         * Close payment modal with animation
         * إغلاق نافذة الدفع مع الحركة
         */
        function closePaymentModal() {
            $('#payment-modal-overlay .modal-content').removeClass('show');
            
            setTimeout(function() {
                $('#payment-modal-overlay').addClass('hidden');
            }, 300);
        }
        
        /**
         * Open add ad modal
         * فتح نافذة إضافة إعلان
         */
        function openAddAdModal() {
            // Reset form
            $('#add-ad-form')[0].reset();
            $('#image-preview').addClass('hidden');
            $('#coupons-container').empty();
            couponCounter = 0;
            
            // Show modal
            $('#add-ad-modal-overlay').removeClass('hidden');
            
            // Trigger animation
            setTimeout(function() {
                $('#add-ad-modal-overlay .modal-content').addClass('show');
            }, 10);
        }
        
        /**
         * Close add ad modal
         * إغلاق نافذة إضافة إعلان
         */
        function closeAddAdModal() {
            $('#add-ad-modal-overlay .modal-content').removeClass('show');
            
            setTimeout(function() {
                $('#add-ad-modal-overlay').addClass('hidden');
                // Reset form
                $('#add-ad-form')[0].reset();
                $('#image-preview').addClass('hidden');
                $('#coupons-container').empty();
            }, 300);
        }
        
        /**
         * Add coupon field dynamically
         * إضافة حقل كوبون ديناميكياً
         */
        function addCouponField(index) {
            const couponHtml = `
                <div class="coupon-field p-4 border border-border rounded-lg bg-gray-50">
                    <div class="flex items-center justify-between mb-3">
                        <h5 class="text-sm font-semibold text-contrast">كوبون ${index}</h5>
                        <button type="button" class="remove-coupon-btn text-red-500 hover:text-red-700 text-sm">
                            حذف
                        </button>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-contrast mb-2">كود الكوبون</label>
                            <input type="text" name="coupons[${index}][code]" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="أدخل كود الكوبون">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-contrast mb-2">نسبة الخصم (%)</label>
                            <input type="number" name="coupons[${index}][discount]" min="0" max="100" step="0.01" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="0.00">
                        </div>
                        <div class="sm:col-span-2">
                            <label class="block text-sm font-medium text-contrast mb-2">تاريخ انتهاء الكوبون</label>
                            <input type="date" name="coupons[${index}][expirationDate]" class="w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
                        </div>
                    </div>
                </div>
            `;
            $('#coupons-container').append(couponHtml);
        }
        
        /**
         * Submit ad form
         * إرسال نموذج الإعلان
         */
        function submitAdForm() {
            // Get form data
            const formData = new FormData($('#add-ad-form')[0]);
            
            // Collect coupons data
            const coupons = [];
            $('.coupon-field').each(function(index) {
                const code = $(this).find('input[name*="[code]"]').val();
                const discount = $(this).find('input[name*="[discount]"]').val();
                const expirationDate = $(this).find('input[name*="[expirationDate]"]').val();
                
                if (code || discount || expirationDate) {
                    coupons.push({
                        code: code || '',
                        discount: discount || 0,
                        expirationDate: expirationDate || ''
                    });
                }
            });
            
            // Add coupons to form data
            formData.append('coupons', JSON.stringify(coupons));
            
            // Disable submit button
            $('#add-ad-submit-btn').prop('disabled', true).text('جاري الإرسال...');
            
            // Submit to API
            $.ajax({
                url: `${API_BASE}/ads`,
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                timeout: 30000,
                success: function(response) {
                    // Success
                    alert('تم إضافة الإعلان بنجاح!');
                    closeAddAdModal();
                    // Reload ads
                    currentPage = 1;
                    loadAds();
                },
                error: function(xhr, status, error) {
                    // Error
                    console.error('Error adding ad:', error);
                    alert('حدث خطأ أثناء إضافة الإعلان. يرجى المحاولة مرة أخرى.');
                },
                complete: function() {
                    // Re-enable submit button
                    $('#add-ad-submit-btn').prop('disabled', false).text('إضافة الإعلان');
                }
            });
        }
        
        /**
         * Process payment with selected method
         * معالجة الدفع بالطريقة المختارة
         */
        function processPayment(planName, planPrice, paymentMethod) {
            // Payment method names in Arabic
            const methodNames = {
                'mada': 'مدى',
                'visa': 'فيزا',
                'mastercard': 'ماستركارد',
                'stc-pay': 'STC Pay',
                'apple-pay': 'Apple Pay',
                'tamara': 'تمارا'
            };
            
            const methodName = methodNames[paymentMethod] || paymentMethod;
            
            // Close payment modal
            closePaymentModal();
            
            // TODO: Implement actual payment processing API call
            // TODO: تنفيذ استدعاء API الفعلي لمعالجة الدفع
            // Example:
            // $.ajax({
            //     url: '/api/payment/process',
            //     method: 'POST',
            //     data: {
            //         plan: planName,
            //         price: planPrice,
            //         method: paymentMethod
            //     },
            //     success: function(response) {
            //         // Redirect to payment gateway or show success
            //         window.location.href = response.paymentUrl;
            //     },
            //     error: function(error) {
            //         alert('حدث خطأ أثناء معالجة الدفع. يرجى المحاولة مرة أخرى.');
            //     }
            // });
            
            // For now, show confirmation
            console.log('Processing payment:', {
                plan: planName,
                price: planPrice,
                method: paymentMethod
            });
            
            // Show success message (replace with actual redirect to payment gateway)
            alert(`سيتم توجيهك إلى صفحة الدفع الآمنة لـ ${methodName} لإتمام عملية الدفع`);
        }
        
        /**
         * Format date string to readable format (Arabic)
         * تنسيق تاريخ إلى صيغة قابلة للقراءة (عربي)
         */
        function formatDate(dateString) {
            if (!dateString) return 'غير متاح';
            
            try {
                const date = new Date(dateString);
                // Arabic month names
                const arabicMonths = [
                    'يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو',
                    'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'
                ];
                
                const day = date.getDate();
                const month = arabicMonths[date.getMonth()];
                const year = date.getFullYear();
                
                return `${day} ${month} ${year}`;
            } catch (e) {
                return dateString;
            }
        }
    </script>
</body>
</html>

